---
title: 重识 Angular
order: 11
---

## 前言
**Angular** 自2021年发布`v13`Ivy 渲染引擎正式稳定后就一直在快速的更新迭代，从2022年6月2日`v14`推出独立 APIs 开发者预览版和严格的类型表单，`v15`独立 APIs 正式稳定且发布组合指令，`v16` 发布新的响应式 Signals 开发者预览版、服务器端渲染和 Hydration 增强，到刚不久的2023年11月8日正式发布了`v17`，推出了新的内置控制流和可延迟视图开发预览版，服务端渲染 SSR 正式稳定，CLI 默认采用 esbuild 和 vite 等等，可以说`v17`是 Angular 框架面向未来的一个新起点，因为 Angular 推出了新的品牌 Logo 和新站点 [Angular.dev](https://angular.dev/)，虽然从`2.0`开始 Angular 的 API 一直保持向后兼容的稳定性，但这次是真的可以说是脱胎换骨，焕然一新，2023 是 Angular 框架的伟大复兴的新起点。

<img src="assets/images/re-intro/new-logo.gif" class="img-center" width="400" height="225" />

我简单给 Angular 过去十年划分为两个时期：稳定期和复兴期，站在 2023 这个时间点，是时候重新认识一下 Angular 这位老朋友了！
<img src="assets/images/re-intro/timeline.png" class="img-center" height="250" />

谈到过去的 Angular，大家脑海中会蹦出很多缺点：
1. 学习门槛高，概念太多学不会
2. 官方文档太难懂，不知从哪下手，不适合新手入门
3. Angular 引入了 NgModules，我只是要做一个简单的 Web 站点，还要了解独有的 NgModule
4. SSR 服务端渲染基本不可用
5. Zone.js 万恶之源，不仅黑盒，性能差，一不留神就踩坑
6. 本地开发慢，连`HMR`都做不好 
7. 把后端的思想迁移到前端，前端根本不需要
8. 很多存在长达 5-6 年的 Issue 一直得不到解决


以上得确是 Angular 一直以来做的不好的地方，但是 Angular 做的好的地方呢？

- **全面**：除了核心视图层功能外，还提供了路由、表单、HttpClient 到安全、测试、动画，选择困难综合征患者的福音
- **标准**：API 标准统一，架构优雅，真正框架级别的强约束，让初学者也能写出健壮的代码，不易出错，所有 Angular 的项目结构和风格基本一致
- **稳定**：标准的语义化版本，每个版本都保持着向后兼容，让开发者有足够的时间迁移，并在谷歌内部进行充分的测试
- **前瞻**：内置选择 TypeScript 和 RxJS，让大小项目开发体验提升，切换更丝滑，TypeScript 目前已成前端标配
- **工具**：Angular CLI 保姆级伺候，每次升级只需执行`ng update`，只要依赖的第三方库不拖后腿，升级也就一杯茶的功夫，且 Schematics 会自动修改破坏性更改的代码，无需手动修改，即使工具做不到也会提示你如何修改
- **组织**：文件遵循单一职责，Class 组件定义状态和交互，装饰器定义组件元数据，Service 共享逻辑和数据，HTML 和 CSS 推荐独立文件，清晰明了
- **解耦**：依赖注入解耦 Service，让代码健壮优雅可维护

那么我们回过头看一下 Angular 的那些缺点，Angular 是如何一步一步去解决的。


## 学习门槛

Angular 引入独立 APIs，无需学习 NgModule 即可上手使用，且 CLI 从`v17`默认生成的项目就是独立 APIs 的，同时默认生成的项目去除了一些非必要的文件和配置，尽可能让初学者接触更少的概念，由浅入深。

目前基本和其他框架的入门门槛一致，甚至更简单，因为 Angular CLI 帮你屏蔽了所有其他琐碎的事情，对于打包构建初学可以完全不用关心，官方内置的就是最佳实践。

其次就是新的 [Angular.dev](https://angular.dev/) 站点，这个站点完全照顾了不同阶段的开发者，对于初学者先花费半个小时看一下`Essentials`(必须要素)章节。

<p>
  <img src="assets/images/re-intro/essentials-dark.png" class="img-center" />
</p>

**Essentials** 章节包含了组件组成、管理动态数据、模板渲染、条件和循环、处理用户交互以及共享业务逻辑，这里只会大概介绍核心概念，当阅读完了此章节后就可以在线跟着教程一步一步写代码了。通过`Coding`一步一步深入学习 Angular，选择在线的 Playground 慢慢练习，无需本地启动。

In-depth Guides (深度指南) 是高级进阶部分，这个章节的每个部分都介绍的非常详细，适合深入学习某一个知识点。

![](assets/images/re-intro/in-depth-guide-dark.png)

除此之外还有开发工具、最佳实践、生态系统以及更加好用的 Reference（包括 Roadmap、API Reference、CLI Reference、迁移等等）。

![](assets/images/re-intro/api-reference-dark.png)

虽然新的 Angular.dev 还是 BETA 版，v18 才会正式发布，但是通过组织结构可以看出非常清晰，当然官方团队后续还要做进一步的优化，所以目前从学习门槛看，Angular 已经变得不是那么高不可攀，欢迎大家学习。


## 独立 APIs

从独立组件到独立应用，Angular 目前可以说完全不用了解 NgModules 的概念，简单的系统无需使用 NgModule 组织代码，配套的 CLI 工具、内置的路由、HttpClient 模块都已经支持独立 APIs，第三方组件库应该陆续都支持了独立组件。

大家可以简单理解 Angular 以前在 NgModule 模块下挂载多个组件、指令和管道，现在一个独立组件就是一个模块，这个独立组件可以单独的引入其他的独立组件，只需要在组件装饰器中声明`imports`即可，独立 APIs 不仅仅让开发者少接触一个 NgModule 的概念，减少初学者心智负担，性能也有大幅度的提升，因为组件的依赖关系查找更加清晰明了。

## 服务端渲染

SSR 的`Hydration`以及一系列改进在`v17`正式稳定且可用，Angular 把生成 SSR/SSG 项目的入口提升到了`ng new`命令，同时把过去的 Universal 仓储迁移到了 Angular CLI 仓储中，并使用`@angular/ssr`新包，足以见得 Angular 官方团队对 SSR 的重视，最重要的是 Angular.dev 新站点默认采用 SSR 做的服务端渲染应用，等于官方团队第一个试水 SSR，且提供了最佳实践，大家抄作业就好了，这就好比 Angular CDK 和 Material Design 组件库一样，至今没有看到比 CDK 写的更优雅的前端代码了，所以这也间接的给了开发者信心，放心使用新的 SSR。

## 开发工具

Angular 从诞生之初就开始打造 CLI 工具，可以说是最早重视 CLI 的前端框架之一，首个提出 Schematics 概念并把它打造成一个生态的框架，此次官方还把实现 Schematics 的工具类库`@schematics/angular/utility`公开给第三方使用，这意味着不用重复造轮子了，且官方会统一考虑这个工具类库的向后兼容。

最重要的是`v17`默认使用`esbuild`+`vite`作为构建工具，本地开发速度和效率直接拉满，HMR 再也不能是被嘲笑的功能了。还有官方做的 DevTools，查看组件层级和状态以及注入依赖树简直不要太方便。


![](assets/images/re-intro/devtools.png)

对于开发工具，Angular 目前可以说是做到了无懈可击。

## Zoneless (无 Zone.js)

既然大家觉得 Zone.js 是万恶之源，那么好吧，Angular 从引入新的响应式 Signals 那一天开始，就意味着 Zoneless（无 Zone.js）不远了，目前 Signals 的核心 API`signal`和`computed`正式稳定，Angular 下一步的重点就是基于 Signal 的组件，组件生命周期的简化，新的输入和查询，我们一起期待在24年6月的`v18`版本可以看到，或许会在次版本提前到来，这样我们可以逐渐的实现无`Zone.js`的 Angular 应用，不仅性能得到了大幅度提升，还解决过去一直遗留的难题和未解决的 Issue。

改底层响应式是一个巨大的工程，需要考虑兼容性和并存问题，请给 Angular 官方团队一点时间，毕竟过去一段时间同时在进行无数个大工程改造，Angular 选择 Signal 作为未来的响应式非常明智，目前 Vue，Preact、Qwik、SoidJS、Sevlet 5.0 以及十三年前的 Knockout 都在采用 Signals，所以当前看 Signals 的确是前端框架的未来。

其次就是基于 Signal 的响应式需要改组件生命周期，会影响到之前的结构型指令`*ngIf`和`*ngFor`，再加上之前的结构型指令有很多问题，所以在做 Signal 组件之前推出了新的内置控制流`@if`和`@for`，顺便还附送了一个`@defer`可延迟视图的功能，这足以看出 Angular 团队做事的严谨和用心。

说到响应式不得不提 Angular 内置的`RxJS`类库，选择`RxJS`真的是有人欢喜有人忧，据官方团队调查有`50%`的开发者赞同 Angular 深入和`RxJS`绑定，甚至内置为视图层的响应式，但是另外的`50%`反对 Angular 和`RxJS`绑定，所以 Signal 是一个两全其美的选择，当然背后最主要的还是 Signals 适合视图层的响应式，喜欢`RxJS`的可以继续深入使用，不喜欢的可以选择不用。

## 依赖注入

那么综上所述，我们发现 Angular 除了打造无 Zoneless 的应用还未完成外，大家诟病的问题基本都得到了完美的解决，再加上 Angular 本身具备的优势，可以说 Angular 正在复兴，当所有的问题都被解决后，唯一一个比其他框架多的概念就是依赖注入，依赖注入对前端开发者来说要求还真是有那么一点高，但是一旦学会再也离不开它，我看到过很多从 Angular 转向其他框架的开发者，基本都在引入 Angular 的依赖注入，因为这是业务逻辑的核心，视图层无外乎是写渲染模板处理事件，随着业务的复杂，我们需要一种架构和设计模式组织我们的业务，那么 Class 服务和依赖注入必然是首选。

## vs 其他框架
在我心中 Angular 才算是真正意义上的框架，他一直在约束开发者的行为，官方还贴心的提供了风格指南，让大家遵循一致的风格写出一致的代码，所以他天生就是在和`灵活性`相悖，众所周知 React 和 Angular 正好是选择了不同思想的框架，React 只提供了基础的核心功能，你可以基于 React 之上打造不同风格和架构的应用，Angular 却很难定制不一样风格的框架，这没有好坏之分，如果你是创业者或者个人开发者，想快速打造一个应用， 追求灵活，React 无疑是最好的选择，当你的团队规模越来越大，应用越来越大，需要找一款稳定不出错的框架，那么 Angular 就特别适合你。

但是当前的 Angular 逐渐在放开一些可以说是`灵活性`的特性，比如`inject`注入函数，`DestroyRef`、`afterNextRender`，以及正在 RFC 中的函数式新输入和查询等等，Angular 逐渐尝试使用面向对象和函数式并存，偏视图层逻辑使用函数式封装 ，业务层使用面向对象 Service 和依赖注入封装，这就像新 Logo 一样，打破过去的盾牌，焕然一新，这需要框架做取舍，目前从我的角度看 Angular 这个度把我的非常好。

既然谈到框架的灵活性，选择如何实现视图层尤其重要，`JSX`天生具备灵活性，在`JS`中写`HTML`，肯定灵活，但是缺点也很明显，水平差的程序员能写出屎一样的代码，选择`HTML`作为模板语言天生就不会很灵活，声明式的 UI 可以在编译期做很多优化，按照一定的规则添加框架级别的模板语法，约束性极强，我经常说`JSX`对写代码的人友好，但是对读代码的人不友好，但是`HTML`模板却恰恰相反，同时选择`JSX`和`HTML`也是个人喜好问题，没有好坏之分，只看适不适合。我个人是投票`HTML`的，因为前端开发人员的水平是最难控制的，所以我选择约束性强的`HTML`，即使这样都未必能约束的住，何况是灵活的`JSX`。

## 最后

那么这样一款越来越好的前端框架 Angular 是你的最爱吗？反正我是爱不释手，迫不及待的想分享给国内的开发者，希望 Angular 能够被越来的越多的国内公司接受和采用。如果你足够细心，你会发现 Angular.dev 的首页有这样一段话：

![](assets/images/re-intro/scale.png)

Angular 不再仅仅是适合中大型项目，任何规模大小的项目都适合，根据规模选择独立 APIs 还是 NgModules，根据团队情况选择基于 Zone.js 还是基于 Signal 的 Zoneless，根据应用的性质决定使用 SSR/SSG 还是 SPA，Angular 把更多的选择权交给了你。
